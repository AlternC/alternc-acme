language : bash
env:
    global:
      - HUB_PROTOCOL=https
      #GITHUB_TOKEN
      - secure: "oDgF1QD9sql2bYxXYkrBCfFm8eo3Hh5EQOLjrproEOVEccUNgSV7JQMRjkuc202QT0pp7Jb42jHAJsVC9nGFECKOoKja9aNCDRF0lLsJSiNG7j4y4i+CaB9FeDROngItyiUnCoLY1bxlv1PP+jro8wEVWsnr52e3eTogbdeGkymdtNfcykqaWSZYbdQgz+QC2kpy1us+MSkM6HCywClrN1jwtv1YqYZk77epwiaHox3BUYh/L3RmNglJNuL7ERVlKoqGBo1Tnd2o4wPSBIobOMHYHEwQTjXvAgn48aXW0fj6BiuTRiI0mEdAbPdz4gHNlWJHNPZ/cJBwMugvzjDUC+SXoHtHC1TvGTFR4FHihu2LGgsvBT+PUDs0RbdHCSq56dla6M82jlAgaP++68QTlDzLoLamJf8cwssTzOo0Q9bcYDeO8f4Cx7JaXmE0OzA9I9hFJy+2OFmi/LEBVDgbKwO+9Z3vZh3mnLsw1tc0GfH0yVciA6XylNaM31BopnTl9ydTAt8V9rBthSG6BypyzlN7XExC1Ftzpbm/CsmnAt08v0Q9bKUPBjhpXZqa2Jlb5XYSfEcBFuE0fU0BjRX6EEqv8I0KYns0H0Fm+eQqMvKX6WcCWYgBKey8UHg00HW219Y7c1Lf731oMD/MSEfQBDi88/UtxHBJ4bc+KaN3xxI="
branches:
  except:
  - nightly
git:
  quiet: true
before_install:
    - curl -fsSL https://cli.github.com/packages/githubcli-archive-keyring.gpg | sudo gpg --dearmor -o /usr/share/keyrings/githubcli-archive-keyring.gpg
    - echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/githubcli-archive-keyring.gpg] https://cli.github.com/packages stable main" | sudo tee /etc/apt/sources.list.d/github-cli.list > /dev/null
    - sudo apt-get -qq update
    - sudo apt-get install -y debhelper devscripts fakeroot build-essential po-debconf gh
    - openssl aes-256-cbc -K $encrypted_2155243bff9e_key -iv $encrypted_2155243bff9e_iv -in 077CC9F2.gpg.enc -out 077CC9F2.gpg -d
    - gpg --import 077CC9F2.gpg
install:
    - debuild '-k9D1DC8DD077CC9F2'
deploy:
    - provider: releases
      skip_cleanup: true
      file_glob: true
      file: "../*.deb"
      api_key:
          secure: "V6cz6M5pcnMesO1VibEF+SoQq2MbW8sJM+4NzmvhWZX1miCmvFaOlYNQN6GW0Dxzr2oPp5pn3CP6pyO0dojI7kWQQCR5smawlz4x9pBe0C3JVA9+BAj+oJj1/TNAbsMirvxwGsNikNsL5X66Eyej3BqnAE6rCrWokfNLgPaghk8kWkcQ1wb08qYtoTu+suZZEG1pu+ct58PvXLZh5mS0J7gag4o9k3egyA/EHJdcK94i5Xh9PSBxE+TF4AY6wM+Sp5a+xmzY1D9LtW8dbEI9f4usLOLFDr3SSvr3C9mQ1Dbg7TUAEMYurj3eElGEJetoHcfeLwitmv4yp5NCS4JOis8PeV6iz84G+3xmj7RZnPW9GetAavNB3vfna/Q7bxPgY4aU4M2PElFbQvAmUuZBPGj3RQVTE6ik0Xs9pbVelN4WNZAiQag7dAek6iUj4I02TbVbQWYERMsze1OEAUPxnGB50o/WJTzQqGRhIGF7BDvfe2UBaV0myr5GtrULD6MtxiYLHc/GWEZhxq1qMLadJuZVSfDkQ8el1FgftUk8Cx8nM8WDdGuiiYr94jj1Hsh92P7PGgReTadKcQqIsB9PTBoTodgAkEfGH6hIswNIkfsOBizrh5qZTRDFBjxUOHuACqSWH3k6mt1lqDSEh5hNASoVsMSeHH+S+tOL9yPtVFw="
      on:
          tags: true
    - provider: releases
      skip_cleanup: true
      file_glob: true
      file: "../*.deb"
      tag_name: "nightly"
      prerelease: true
      name: Automatic nightly build by Travis on $(date +'%F %T %Z').
      target_commitish: $TRAVIS_COMMIT
      api_key:
          secure: "V6cz6M5pcnMesO1VibEF+SoQq2MbW8sJM+4NzmvhWZX1miCmvFaOlYNQN6GW0Dxzr2oPp5pn3CP6pyO0dojI7kWQQCR5smawlz4x9pBe0C3JVA9+BAj+oJj1/TNAbsMirvxwGsNikNsL5X66Eyej3BqnAE6rCrWokfNLgPaghk8kWkcQ1wb08qYtoTu+suZZEG1pu+ct58PvXLZh5mS0J7gag4o9k3egyA/EHJdcK94i5Xh9PSBxE+TF4AY6wM+Sp5a+xmzY1D9LtW8dbEI9f4usLOLFDr3SSvr3C9mQ1Dbg7TUAEMYurj3eElGEJetoHcfeLwitmv4yp5NCS4JOis8PeV6iz84G+3xmj7RZnPW9GetAavNB3vfna/Q7bxPgY4aU4M2PElFbQvAmUuZBPGj3RQVTE6ik0Xs9pbVelN4WNZAiQag7dAek6iUj4I02TbVbQWYERMsze1OEAUPxnGB50o/WJTzQqGRhIGF7BDvfe2UBaV0myr5GtrULD6MtxiYLHc/GWEZhxq1qMLadJuZVSfDkQ8el1FgftUk8Cx8nM8WDdGuiiYr94jj1Hsh92P7PGgReTadKcQqIsB9PTBoTodgAkEfGH6hIswNIkfsOBizrh5qZTRDFBjxUOHuACqSWH3k6mt1lqDSEh5hNASoVsMSeHH+S+tOL9yPtVFw="
      on:
          branch: master
before_deploy:
    - >
      if [[ $TRAVIS_BRANCH == "master" ]]; then
        gh release delete nightly -R ${TRAVIS_REPO_SLUG} -y
        git tag -f nightly || true &&
        git remote add gh https://${GITHUB_TOKEN}@github.com/${TRAVIS_REPO_SLUG}.git &&
        git push --delete -f gh nightly || true &&
        git push -f gh nightly || true
      fi
